name: Python CI/CD (Tests & Linting)

# Triggers the workflow on push or pull request to the 'main' branch, 
# and also allows manual runs.
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    # Define a matrix to run the tests on multiple Python versions
    strategy:
      matrix:
        python-version: ['3.10', '3.11'] # Using common recent versions

    steps:
    - uses: actions/checkout@v4 # Step 1: Check out the repository code

    - name: Set up Python ${{ matrix.python-version }} # Step 2: Set up the Python environment
      uses: actions/setup-python@v4
      with:
        python-version: ${{ matrix.python-version }}

    - name: Install Dependencies # Step 3: Install project packages
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        # Install a linter/formatter for code quality check
        pip install flake8

    - name: Run Linting (Code Style Check) # Step 4: Check code for style errors
      run: |
        # Use flake8 to check all Python files in the 'src' directory
        flake8 src --count --exit-on-non-zero-exit --max-complexity=10 --max-line-length=120 --statistics
        
    - name: Run Unit Tests # Step 5: Execute any tests in the 'tests' directory
      # This step assumes you have some basic tests defined in the 'tests' folder
      run: |
        python -m unittest discover tests
